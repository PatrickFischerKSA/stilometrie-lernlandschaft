function markCompleted(taskId){let c=JSON.parse(localStorage.getItem('completedTasks'))||[];if(!c.includes(taskId)){c.push(taskId);localStorage.setItem('completedTasks',JSON.stringify(c));}updateProgress();}
function updateProgress(){const c=JSON.parse(localStorage.getItem('completedTasks'))||[];const p=document.getElementById('progress');if(p)p.textContent='Bearbeitete Aufgaben: '+c.length;}
function getCustomMsg(box,kind){const k='data-'+kind;return box&&box.hasAttribute(k)?box.getAttribute(k):null;}
function checkMC(id,correct){const inputs=document.querySelectorAll('input[name="'+id+'"]:checked');const ua=Array.from(inputs).map(i=>i.value);const fb=document.getElementById(id+'-feedback');if(!fb)return;const missing=correct.filter(a=>!ua.includes(a));const extra=ua.filter(a=>!correct.includes(a));const ok=missing.length===0&&extra.length===0&&ua.length===correct.length;if(ok){fb.className='feedback correct';fb.textContent=getCustomMsg(fb,'correct')||'Korrekt.';markCompleted(id);return;}if(ua.length===0){fb.className='feedback incorrect';fb.textContent=getCustomMsg(fb,'none')||'Keine Auswahl.';return;}const partial=ua.filter(a=>correct.includes(a)).length>0;fb.className='feedback '+(partial?'partial':'incorrect');let msg=getCustomMsg(fb,partial?'partial':'incorrect')||(partial?'Teilweise korrekt.':'Nicht korrekt.');let details=[];if(missing.length)details.push('Fehlt: '+missing.join(', '));if(extra.length)details.push('Zu viel: '+extra.join(', '));fb.textContent=msg+(details.length?' '+details.join(' | '):'');}
function checkText(id,keys){const ta=document.getElementById(id+'-input');const fb=document.getElementById(id+'-feedback');if(!ta||!fb)return;const t=(ta.value||'').toLowerCase();const matches=keys.filter(k=>t.includes(k));const missing=keys.filter(k=>!t.includes(k));const half=Math.ceil(keys.length/2);const ok=matches.length>=keys.length;const partial=!ok&&(matches.length>=Math.min(2,keys.length)||matches.length>=half);if(ok){fb.className='feedback correct';fb.textContent=getCustomMsg(fb,'correct')||'Sehr gut.';markCompleted(id);return;}if(t.length===0){fb.className='feedback incorrect';fb.textContent=getCustomMsg(fb,'none')||'Noch keine Antwort.';return;}fb.className='feedback '+(partial?'partial':'incorrect');const msg=getCustomMsg(fb,partial?'partial':'incorrect')||(partial?'Ansatz erkennbar.':'Zu allgemein.');fb.textContent=msg+(missing.length?' Fehlende Begriffe: '+missing.join(', '):'');}
document.addEventListener('DOMContentLoaded',updateProgress);